[tools]
# flutter = "stable" # 必要であればコメントアウトを外してバージョンを指定してください

[tasks.init]
description = "依存関係のインストールとコード生成の実行"
run = """
#!/bin/bash
set -e

echo "Running flutter pub get..."
flutter pub get

# build_runnerを実行するディレクトリのリスト
dirs=("." "app" "packages/core" "packages/feature")

for dir in "${dirs[@]}"; do
  if [ -d "$dir" ] && [ -f "$dir/pubspec.yaml" ]; then
    # pubspec.yamlの中にbuild_runnerが含まれているか確認
    if grep -q "build_runner:" "$dir/pubspec.yaml"; then
      echo "Running build_runner build in $dir..."
      (cd "$dir" && dart run build_runner build --delete-conflicting-outputs)
    fi
  fi
done
"""

[tasks.watch]
description = "コード生成の監視 (カレントディレクトリで実行)"
run = "dart run build_runner watch --delete-conflicting-outputs"

[tasks.build]
alias = "b"
description = "コード生成の実行 (カレントディレクトリで実行)"
run = "dart run build_runner build --delete-conflicting-outputs"

